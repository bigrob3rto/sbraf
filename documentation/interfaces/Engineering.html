<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>@coreui/coreui-free-angular-admin-template documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">@coreui/coreui-free-angular-admin-template documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">












<ol class="breadcrumb">
  <li>Interfaces</li>
  <li>Engineering</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/analysis/engineering/engineering.component.ts</code>
        </p>



        <section>
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                        <a href="#item_contrib">item_contrib</a>
                                </li>
                                <li>
                                        <a href="#item_incidence">item_incidence</a>
                                </li>
                                <li>
                                        <a href="#item_price">item_price</a>
                                </li>
                                <li>
                                        <a href="#item_quantity_sum">item_quantity_sum</a>
                                </li>
                                <li>
                                        <a href="#merged_product_name">merged_product_name</a>
                                </li>
                                <li>
                                        <a href="#order_num_per_product">order_num_per_product</a>
                                </li>
                                <li>
                                        <a href="#price">price</a>
                                </li>
                                <li>
                                        <a href="#prod_category_id">prod_category_id</a>
                                </li>
                                <li>
                                        <a href="#prod_code">prod_code</a>
                                </li>
                                <li>
                                        <a href="#prod_food_cost">prod_food_cost</a>
                                </li>
                                <li>
                                        <a href="#prod_id">prod_id</a>
                                </li>
                                <li>
                                        <a href="#prod_name">prod_name</a>
                                </li>
                                <li>
                                        <a href="#quantity">quantity</a>
                                </li>
                                <li>
                                        <a href="#timeline_of_purchase">timeline_of_purchase</a>
                                </li>
                                <li>
                                        <a href="#total_contrib">total_contrib</a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section>
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="item_contrib"></a>
                                        <span class="name"><b>item_contrib</b><a href="#item_contrib"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>item_contrib:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="item_incidence"></a>
                                        <span class="name"><b>item_incidence</b><a href="#item_incidence"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>item_incidence:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="item_price"></a>
                                        <span class="name"><b>item_price</b><a href="#item_price"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>item_price:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="item_quantity_sum"></a>
                                        <span class="name"><b>item_quantity_sum</b><a href="#item_quantity_sum"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>item_quantity_sum:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="merged_product_name"></a>
                                        <span class="name"><b>merged_product_name</b><a href="#merged_product_name"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>merged_product_name:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="order_num_per_product"></a>
                                        <span class="name"><b>order_num_per_product</b><a href="#order_num_per_product"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>order_num_per_product:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="price"></a>
                                        <span class="name"><b>price</b><a href="#price"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>price:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="prod_category_id"></a>
                                        <span class="name"><b>prod_category_id</b><a href="#prod_category_id"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>prod_category_id:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="prod_code"></a>
                                        <span class="name"><b>prod_code</b><a href="#prod_code"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>prod_code:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="prod_food_cost"></a>
                                        <span class="name"><b>prod_food_cost</b><a href="#prod_food_cost"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>prod_food_cost:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="prod_id"></a>
                                        <span class="name"><b>prod_id</b><a href="#prod_id"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>prod_id:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="prod_name"></a>
                                        <span class="name"><b>prod_name</b><a href="#prod_name"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>prod_name:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="quantity"></a>
                                        <span class="name"><b>quantity</b><a href="#quantity"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>quantity:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="timeline_of_purchase"></a>
                                        <span class="name"><b>timeline_of_purchase</b><a href="#timeline_of_purchase"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>timeline_of_purchase:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="total_contrib"></a>
                                        <span class="name"><b>total_contrib</b><a href="#total_contrib"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>total_contrib:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { AfterViewInit, Component, Input, isDevMode, OnInit, ViewChild, ViewChildren } from &#x27;@angular/core&#x27;;
import { BaseTableComponent } from &#x27;../../prod-table/base-list.component&#x27;
import { Category } from &#x27;../../prod-table/cat-table.component&#x27;;

import { TableLib } from &#x27;../../prod-table/lib/table-lib&#x27;;
import { Product } from &#x27;../../prod-table/prod-table.component&#x27;;
import { EngTotalsComponent } from &#x27;./eng-totals/eng-totals.component&#x27;;
import { MatrixChartComponent } from &#x27;./matrixchart/matrixchart.component&#x27;;
import { NewpriceComponent } from &#x27;./newprice/newprice.component&#x27;;
import { DateRangeComponent } from &#x27;../../views/daterange/daterange.component&#x27;;
import { Menu } from &#x27;../menu-editor/menu/menu-table.component&#x27;;
import { MenuProduct } from &#x27;../menu-editor/menu-editor.component&#x27;;
import { MCFilterComponent } from &#x27;../../views/mcfilter/mcfilter.component&#x27;;

export interface Engineering {
  prod_name: string,
  prod_code: string,
  prod_id: number,
  item_price: number,
  price: number,
  prod_category_id: string,
  timeline_of_purchase: string,
  order_num_per_product: number,
  prod_food_cost: number,
  item_quantity_sum: number,
  quantity: number,
  item_contrib: number,
  item_incidence: number,
  total_contrib: number,
  merged_product_name: string
}


@Component({
  selector: &#x27;app-engineering&#x27;,
  templateUrl: &#x27;./engineering.component.html&#x27;,
  styleUrls: [&#x27;./engineering.component.css&#x27;]
})



export class EngineeringComponent extends BaseTableComponent implements OnInit {
  title &#x3D; &quot;Engineering&quot;;
  btnSave &#x3D; false;
  public btnPrint &#x3D; true;

  start: string;   // start date
  stop: string;    // stop date
  public domLayout &#x3D; &#x27;autoHeight&#x27;;

  public pb_current: number &#x3D; 0;

  @Input() messageService;    //refernce to message Service

  // view children components
  @ViewChild(EngTotalsComponent, { static: false }) eng_totals: EngTotalsComponent;
  @ViewChild(MatrixChartComponent, { static: false }) matrixChartComponent: MatrixChartComponent;
  @ViewChild(NewpriceComponent, { static: false }) newpriceComponent: NewpriceComponent;
  @ViewChild(DateRangeComponent, { static: false }) daterangeComponent: DateRangeComponent;
  @ViewChild(&#x27;mcfilter&#x27;) mcfilter: MCFilterComponent;

  public columnDefs &#x3D; [
    { headerName: &#x27;Category&#x27;, field: &#x27;prod_category_id&#x27;, sortable: true, resizable: true, filter: &#x27;agTextColumnFilter&#x27; },
    { headerName: &#x27;Category ID&#x27;, field: &#x27;prod_category_number&#x27;, sortable: true, resizable: true, filter: &#x27;agTextColumnFilter&#x27; },
    { headerName: &#x27;Product&#x27;, field: &#x27;merged_product_name&#x27;, sortable: true, resizable: true, filter: &#x27;agTextColumnFilter&#x27; },
    // { headerName: &#x27;Codice&#x27;, field: &#x27;prod_code&#x27;, }, 
    // { headerName: &#x27;ID&#x27;, field: &#x27;prod_id&#x27;, sortable: true, resizable: true, filter: &#x27;agTextColumnFilter&#x27; },
    // { headerName: &#x27;Timeline&#x27;, field: &#x27;timeline_of_purchase&#x27;, },
    {
      headerName: &#x27;Price&#x27;, field: &#x27;price&#x27;, sortable: true, resizable: true, filter: &#x27;agTextColumnFilter&#x27;, editable: true,
      valueFormatter: params &#x3D;&gt; TableLib.currencyFormatter(params.value),
    },
    // { headerName: &#x27;Order #&#x27;, field: &#x27;order_num_per_product&#x27;, sortable: true, resizable: true, filter: &#x27;agTextColumnFilter&#x27; },
    {
      headerName: &#x27;Food Cost&#x27;, field: &#x27;prod_food_cost&#x27;, sortable: true,
      editable: true, resizable: true, filter: &#x27;agTextColumnFilter&#x27;,
      valueFormatter: params &#x3D;&gt; TableLib.currencyFormatter(params.value),
    },
    {
      headerName: &#x27;Tot Qty&#x27;, field: &#x27;quantity&#x27;, sortable: true, resizable: true, filter: &#x27;agTextColumnFilter&#x27;,
      cellStyle: { backgroundColor: &#x27;lightblue&#x27; },
    },
    {
      headerName: &#x27;Qty %&#x27;, field: &#x27;item_quantity_perc&#x27;, sortable: true, resizable: true, filter: &#x27;agTextColumnFilter&#x27;,
      valueFormatter: params &#x3D;&gt; TableLib.percentageFormatter(params.value),
    },
    {
      headerName: &#x27;Contribution&#x27;, field: &#x27;item_contrib&#x27;, sortable: true, resizable: true, filter: &#x27;agTextColumnFilter&#x27;,
      valueFormatter: params &#x3D;&gt; TableLib.currencyFormatter(params.value),
    },
    {
      headerName: &#x27;Incidence&#x27;, field: &#x27;item_incidence&#x27;, sortable: true, resizable: true, filter: &#x27;agTextColumnFilter&#x27;,
      valueFormatter: params &#x3D;&gt; TableLib.percentageFormatter(params.value),
    },
    {
      headerName: &#x27;Total cost&#x27;, field: &#x27;total_cost&#x27;, sortable: true, resizable: true, filter: &#x27;agTextColumnFilter&#x27;,
      valueFormatter: params &#x3D;&gt; TableLib.currencyFormatter(params.value),
    },
    {
      headerName: &#x27;Total Contribution&#x27;, field: &#x27;total_contrib&#x27;, sortable: true, resizable: true, filter: &#x27;agTextColumnFilter&#x27;,
      valueFormatter: params &#x3D;&gt; TableLib.currencyFormatter(params.value),
    },
    {
      headerName: &#x27;Total Gross&#x27;, field: &#x27;total_gross&#x27;, sortable: true, resizable: true, filter: &#x27;agTextColumnFilter&#x27;,
      valueFormatter: params &#x3D;&gt; TableLib.currencyFormatter(params.value),
    },

  ];



  /*************************************************************************
  *  get and modify data to display  
  */
  ngOnInit() {
    // receive message for loading status
    this.globalService.loadStatus.subscribe(async message &#x3D;&gt; {
      if (message) {
        this.pb_current &#x3D; Number(message[0]) / Number(message[1]) * 100;
        // console.log(&quot;received:&quot;, this.pb_current);
        if (this.pb_current &#x3D;&#x3D; 100)
          setTimeout(() &#x3D;&gt; {                           //&lt;&lt;&lt;---using ()&#x3D;&gt; syntax
            this.pb_current &#x3D; 101;
          }, 1000);

      }
    });
    // load theme from local storage
    this.theme &#x3D; localStorage.getItem(&#x27;ag-grid-theme&#x27;);
  }




  // intercept tab switch event in order to align columns in ag-grid table
  confirmTabSwitch($event) {
    // console.log(&quot;tabClick&quot;,$event);
  }

  /*****************************************************
 *    received event from mcfilter component
 */
  onMenuSelect(menu: Menu) {
    // console.log(&quot;Received select: &quot;, menu.menu_name);
    this.daterangeComponent.date1 &#x3D; TableLib.utcToNgb(menu.menu_from);
    this.daterangeComponent.date2 &#x3D; TableLib.utcToNgb(menu.menu_to);
    this.daterangeComponent.refresh();

    // this.refreshData();
  }


  /*************************************************************************
     *  get and modify data to display  
     */
  async getData_old(): Promise&lt;Engineering[]&gt; {

    let new_start &#x3D; this.ngbDateParserFormatter.format(this.daterangeComponent.date1); // e.g. myDate &#x3D; 2017-01-01
    let new_stop &#x3D; this.ngbDateParserFormatter.format(this.daterangeComponent.date2); // e.g. myDate &#x3D; 2017-01-01


    if (new_start !&#x3D; this.start || new_stop !&#x3D; this.stop) {
      this.start &#x3D; new_start;
      this.stop &#x3D; new_stop;
      this.awsService.clearSession(&#x27;data&#x27;);
    }

    // get eng data    invoke API Gateway Service , async /await 
    let engArr_all: Engineering[] &#x3D; await this.awsService.getEngineering(this.start, this.stop);
    // trasform category ID into catagory name
    let catArr: Category[] &#x3D; await this.awsService.getCategories();

    // hash map/table
    let ht: Map&lt;string, number&gt; &#x3D; new Map();


    // load menu dropdown
    const menuArr &#x3D; await this.awsService.getMenus();
    const menuFound: Menu &#x3D; menuArr.find(menu &#x3D;&gt; menu.menu_name &#x3D;&#x3D; this.mcfilter.menuSelected);
    if (!menuFound)
      return Promise.reject();

    // get product of Menu
    const menu_products &#x3D; menuFound.menu_products;
    if (!menu_products)
      return Promise.reject();

    // return Promise.resolve([]);
    const menu_products_id &#x3D; menu_products.map(mp &#x3D;&gt; mp.product_id);

    const engArr &#x3D; engArr_all.filter(item &#x3D;&gt; menu_products_id.includes(item.prod_id));

    const sum_qty &#x3D; engArr.reduce((accumulator, current) &#x3D;&gt;
      accumulator + Number(current.item_quantity_sum), 0);

    engArr.forEach(row &#x3D;&gt; {   // for each row in table Engineering
      // update calculation
      row[&#x27;item_quantity_perc&#x27;] &#x3D; row.item_quantity_sum / sum_qty * 100;
      row[&#x27;total_cost&#x27;] &#x3D; row.item_quantity_sum * row.prod_food_cost;
      row[&#x27;total_contribution&#x27;] &#x3D; row.item_quantity_sum * row.item_contrib;
      row[&#x27;total_gross&#x27;] &#x3D; row.item_quantity_sum * row.item_price;
      row.price &#x3D; row.item_price;
      row.merged_product_name &#x3D; row.prod_name;
      row.quantity &#x3D; row.item_quantity_sum;

      let catFound &#x3D; catArr.find(x &#x3D;&gt; x.categoryid &#x3D;&#x3D; row.prod_category_id);  // find corresponding category
      if (catFound) {
        row[&#x27;prod_category_number&#x27;] &#x3D; row.prod_category_id;
        row.prod_category_id &#x3D; String(catFound.name);   // assign name instead of ID
      }
      else
        row.prod_category_id &#x3D; String(row.prod_category_id);  //convert to string
      // push unique keys to map
      ht.set(row.prod_category_id, 0);
    });

    return engArr;
  }


  /*************************************************************************
   *  get and modify data to display  
   */
  async getData(): Promise&lt;Engineering[]&gt; {
    // const newCalls &#x3D; [52, 45, 46]
    // if (!newCalls.includes(this.awsService.getStrId()))
    //   return this.getData_old();

    let new_start &#x3D; this.ngbDateParserFormatter.format(this.daterangeComponent.date1); // e.g. myDate &#x3D; 2017-01-01
    let new_stop &#x3D; this.ngbDateParserFormatter.format(this.daterangeComponent.date2); // e.g. myDate &#x3D; 2017-01-01


    if (new_start !&#x3D; this.start || new_stop !&#x3D; this.stop) {
      this.start &#x3D; new_start;
      this.stop &#x3D; new_stop;
      this.awsService.clearSession(&#x27;data&#x27;);
    }

    let engArr_all: Engineering[];
    // get eng data    invoke API Gateway Service , async /await 
    engArr_all &#x3D; await this.awsService.getEngineeringV2(this.start, this.stop);
    // trasform category ID into catagory name
    let catArr: Category[] &#x3D; await this.awsService.getCategories();

    // hash map/table
    // let ht: Map&lt;string, number&gt; &#x3D; new Map();


    // load menu dropdown
    const menuArr &#x3D; await this.awsService.getMenus();
    const menuFound: Menu &#x3D; menuArr.find(menu &#x3D;&gt; menu.menu_name &#x3D;&#x3D; this.mcfilter.menuSelected);
    if (!menuFound)
      return Promise.reject();

    // cast to MenuProduct class
    const menu_products &#x3D; menuFound.menu_products;
    if (!menu_products)
      return Promise.reject();
    // products in menu
    const products &#x3D; menu_products;

    // return Promise.resolve([]);
    // const menu_products_id &#x3D; menu_products.map(mp &#x3D;&gt; mp.product_id);
    const menu_products_merged_names &#x3D; menu_products.map(mp &#x3D;&gt; mp.product_merged_name);

    // const engArr &#x3D; engArr_all.filter(item &#x3D;&gt; menu_products_id.includes(item.prod_id));
    const engArr &#x3D; engArr_all.filter(item &#x3D;&gt; menu_products_merged_names.includes(item.merged_product_name));

    // hash map/table
    let ht: Map&lt;string, Product&gt; &#x3D; new Map();

    const sum_qty &#x3D; engArr.reduce((accumulator, current) &#x3D;&gt;
      accumulator + Number(current.quantity), 0);

    engArr.forEach(row &#x3D;&gt; {   // for each row in table Engineering
      let prodFound &#x3D; products.find(x &#x3D;&gt; x.product_merged_name &#x3D;&#x3D; row.merged_product_name);  // TODO item_product_id
      if (prodFound !&#x3D; undefined) {
        // push unique keys to map
        ht.set(prodFound.product_merged_name, prodFound);
      }

      // update calculation
      row.prod_food_cost &#x3D; Number(row.prod_food_cost);
      row.item_contrib &#x3D; row.price - row.prod_food_cost;
      row.item_incidence &#x3D; +(row.prod_food_cost / row.price * 100).toFixed(1);
      row[&#x27;item_quantity_perc&#x27;] &#x3D; row.quantity / sum_qty * 100;
      row[&#x27;total_cost&#x27;] &#x3D; row.quantity * Number(row.prod_food_cost);
      row[&#x27;total_contrib&#x27;] &#x3D; row.quantity * row.item_contrib;
      row[&#x27;total_gross&#x27;] &#x3D; row.quantity * row.price;

      let catFound &#x3D; catArr.find(x &#x3D;&gt; x.categoryid &#x3D;&#x3D; row.prod_category_id);  // find corresponding category
      if (catFound) {
        row[&#x27;prod_category_number&#x27;] &#x3D; row.prod_category_id;
        row.prod_category_id &#x3D; String(catFound.name);   // assign name instead of ID
      }
      else
        row.prod_category_id &#x3D; String(row.prod_category_id);  //convert to string
      // push unique keys to map
      // ht.set(row.prod_category_id, 0);
    });

    return engArr;
  }

  // extend to avoid inital refresh
  onGridReady(params) {
    this.gridApi &#x3D; params.api;
    this.gridColumnApi &#x3D; params.columnApi;
    // console.log(&quot;*** onGridReady BS call refreshData&quot;);
    // this.refreshData();
  }

  onFirstDataRendered(params) {
    // params.api.sizeColumnsToFit();  // resize column width
  }

  /**************************************************************+
   * extends  baseList refreshData
   */
  public refreshData() {
    // check user logged
    if (!this.cognitoService.isUserLogged()) {
      this.messageService.show(&quot;Please login first.&quot;)
      return;
    }
    // check store selected
    if (!this.awsService.getStrId()) {
      this.messageService.show(&quot;Please select Store first.&quot;)
      return;
    }
    this.loading &#x3D; true;

    this.getData().then(data &#x3D;&gt; {    // call async with Promise
      // console.log(&quot;received: &quot;, data);
      this.rowData &#x3D; data;              // assign new data table
      // this.gridApi.refreshCells();      // refhresh table
      setTimeout(() &#x3D;&gt; {                           //do on next cycle
        this.updateCharts();
      });
      this.loading &#x3D; false;             // reset loading spinner 
    });
  }


  refresh &#x3D; () &#x3D;&gt; {
    if (this.canDeactivate()) {
      this.unsaved &#x3D; false;
      this.awsService.clearSession(&#x27;data&#x27;);
      this.pb_current &#x3D; 0;
      this.refreshData();
    }
  }

  /**************************************************************+
   * extends  baseList refreshData
   */
  updateCharts() {

    // update children components
    this.matrixChartComponent.update(this.gridApi);

    this.eng_totals.update(this.gridApi, this.start, this.stop);
    this.newpriceComponent.update(this.gridApi);
    this.newpriceComponent.setFilter(this.gridApi.getFilterModel());
  }





  /*****************************************************
   *    received event from mcfilter component
   */
  onCategorySelect(cat_name) {


    let model &#x3D; {
      prod_category_id:
      {
        filter: cat_name,  // filter by category
        filterType: &quot;text&quot;,
        type: &quot;contains&quot;
      }
    }
    if (cat_name &#x3D;&#x3D; &#x27;All&#x27;)  // reset filters
      model &#x3D; null;


    this.gridApi.setFilterModel(model);

    // update charts after set filters
    this.updateCharts();
  }


  getContextMenuItems &#x3D; (params) &#x3D;&gt; {
    var result &#x3D; [
      {
        name: &#x27;Autosize Columns&#x27;,           // copy field
        action: () &#x3D;&gt; {
          params.api.sizeColumnsToFit();
        }
      },
      {
        name: &#x27;Copy&#x27;,
        action: () &#x3D;&gt; {
          this.onMenuClipboard(params.value);
        }
      },
      {
        name: &#x27;Export&#x27;,
        tooltip: &#x27;Export table&#x27;,
        subMenu: [
          {
            name: &#x27;Export as csv&#x27;,
            action: () &#x3D;&gt; {
              params.api.exportDataAsCsv(params);
            }
          },
          {
            name: &#x27;Export to Excel&#x27;,
            action: () &#x3D;&gt; {
              params.api.exportDataAsExcel(params);
            }
          }
        ] //end row submenu
      }
    ];
    return result;
  }
}
</code></pre>
    </div>
</div>


                   




                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'Engineering.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
