<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>@coreui/coreui-free-angular-admin-template documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">@coreui/coreui-free-angular-admin-template documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">












<ol class="breadcrumb">
  <li>Interfaces</li>
  <li>Product</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/prod-table/prod-table.component.ts</code>
        </p>



        <section>
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                        <a href="#product_category_id">product_category_id</a>
                                </li>
                                <li>
                                        <a href="#product_code">product_code</a>
                                </li>
                                <li>
                                        <a href="#product_description">product_description</a>
                                </li>
                                <li>
                                        <a href="#product_discount">product_discount</a>
                                </li>
                                <li>
                                        <a href="#product_enabled">product_enabled</a>
                                </li>
                                <li>
                                        <a href="#product_food_cost_ext">product_food_cost_ext</a>
                                </li>
                                <li>
                                        <a href="#product_id">product_id</a>
                                </li>
                                <li>
                                        <a href="#product_input_source">product_input_source</a>
                                </li>
                                <li>
                                        <a href="#product_kasavana_category">product_kasavana_category</a>
                                </li>
                                <li>
                                        <a href="#product_merged_code">product_merged_code</a>
                                </li>
                                <li>
                                        <a href="#product_merged_name">product_merged_name</a>
                                </li>
                                <li>
                                        <a href="#product_name">product_name</a>
                                </li>
                                <li>
                                        <a href="#product_note">product_note</a>
                                </li>
                                <li>
                                        <a href="#product_quantity">product_quantity</a>
                                </li>
                                <li>
                                        <a href="#product_sell_price">product_sell_price</a>
                                </li>
                                <li>
                                        <a href="#product_structure_id">product_structure_id</a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section>
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="product_category_id"></a>
                                        <span class="name"><b>product_category_id</b><a href="#product_category_id"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>product_category_id:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="product_code"></a>
                                        <span class="name"><b>product_code</b><a href="#product_code"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>product_code:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="product_description"></a>
                                        <span class="name"><b>product_description</b><a href="#product_description"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>product_description:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="product_discount"></a>
                                        <span class="name"><b>product_discount</b><a href="#product_discount"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>product_discount:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="product_enabled"></a>
                                        <span class="name"><b>product_enabled</b><a href="#product_enabled"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>product_enabled:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="product_food_cost_ext"></a>
                                        <span class="name"><b>product_food_cost_ext</b><a href="#product_food_cost_ext"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>product_food_cost_ext:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="product_id"></a>
                                        <span class="name"><b>product_id</b><a href="#product_id"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>product_id:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="product_input_source"></a>
                                        <span class="name"><b>product_input_source</b><a href="#product_input_source"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>product_input_source:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="product_kasavana_category"></a>
                                        <span class="name"><b>product_kasavana_category</b><a href="#product_kasavana_category"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>product_kasavana_category:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="product_merged_code"></a>
                                        <span class="name"><b>product_merged_code</b><a href="#product_merged_code"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>product_merged_code:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="product_merged_name"></a>
                                        <span class="name"><b>product_merged_name</b><a href="#product_merged_name"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>product_merged_name:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="product_name"></a>
                                        <span class="name"><b>product_name</b><a href="#product_name"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>product_name:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="product_note"></a>
                                        <span class="name"><b>product_note</b><a href="#product_note"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>product_note:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="product_quantity"></a>
                                        <span class="name"><b>product_quantity</b><a href="#product_quantity"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>product_quantity:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="product_sell_price"></a>
                                        <span class="name"><b>product_sell_price</b><a href="#product_sell_price"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>product_sell_price:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="product_structure_id"></a>
                                        <span class="name"><b>product_structure_id</b><a href="#product_structure_id"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>product_structure_id:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { BaseTableComponent } from &#x27;./base-list.component&#x27;
import { Component, HostListener } from &#x27;@angular/core&#x27;;
import { TableLib } from &#x27;./lib/table-lib&#x27;;
import { Category } from &#x27;./cat-table.component&#x27;;

export interface Product {
  product_id: number,
  product_name: string,
  product_code: string,
  product_sell_price: number,
  product_quantity: number,
  product_note: string,
  product_category_id: number,
  product_description: string,
  product_discount: number,
  product_enabled: boolean,
  product_kasavana_category: string,
  product_input_source: string,
  product_food_cost_ext: number,
  product_structure_id: number
  product_merged_name: string,
  product_merged_code: number
}

export interface ProductMerged {
  code: number
  name: string,
  product_id: number,
}

@Component({
  selector: &#x27;app-prod-table&#x27;,
  templateUrl: &#x27;./base-list.component.html&#x27;,
  // styleUrls: [&#x27;./prod-table.component.css&#x27;]
})



export class ProdTableComponent extends BaseTableComponent {
  title &#x3D; &quot;Product&quot;;
  btnNew &#x3D; true;
  btnDelete &#x3D; true;
  btnUndelete &#x3D; true;
  ptnPrint &#x3D; true;
  
  // save category names for dropdown select in table
  private categories: String[] &#x3D; [];
  public domLayout &#x3D; &#x27;normal&#x27;;

  columnDefs &#x3D; [
    {
      headerName: &#x27;Product Merged&#x27;, field: &#x27;product_merged_name&#x27;, rowGroup: true, width: 150, editable: true, hide: false,
      // cellRenderer: function (params) {
      //   if (params.node.group)
      //     return params.node.key;
      //   if (params.node.data &amp;&amp; params.node.data.changed)
      //     return &#x27;&lt;span&gt;&lt;i style&#x3D;&quot;color: Orange;&quot; class&#x3D;&quot;fa fa-warning&quot;&gt;&lt;/i&gt;&#x27; + params.value + &#x27;&lt;/span&gt;&#x27;;
      //   else
      //     return &#x27;&lt;span&gt;&#x27; + params.value + &#x27;&lt;/span&gt;&#x27;;
      // }
    },
    {
      headerName: &#x27;Product&#x27;, field: &#x27;product_name&#x27;, width: 300, editable: true, sortable: true,
    },
    {
      headerName: &#x27;Id&#x27;, field: &#x27;product_id&#x27;, width: 110, editable: true,
    },
    { headerName: &#x27;Category ID&#x27;, field: &#x27;product_category_id&#x27;, width: 110, editable: false },
    {
      headerName: &#x27;Category&#x27;, field: &#x27;ccc_category_name&#x27;, editable: true, width: 150,
      cellEditor: &#x27;agRichSelectCellEditor&#x27;, // only exisiting categories can be selected
      cellEditorParams: values &#x3D;&gt; {
        return {
          values: this.categories
        }
      }
    },

    // { headerName: &#x27;Code&#x27;, field: &#x27;product_code&#x27;   },
    { headerName: &#x27;Note&#x27;, field: &#x27;product_note&#x27;, editable: true },
    // {
    //   headerName: &#x27;Sell_price&#x27;, field: &#x27;product_sell_price&#x27;, editable: true, width: 110,
    //   valueFormatter: params &#x3D;&gt; TableLib.currencyFormatter(params.value),
    // },
    // { headerName: &#x27;Qty&#x27;, field: &#x27;product_quantity&#x27;, width: 130, editable: true   },
    // { headerName: &#x27;Description&#x27;, field: &#x27;product_description&#x27;,  editable: true },
    // { headerName: &#x27;Discount&#x27;, field: &#x27;product_discount&#x27;   },
    // { headerName: &#x27;Enabled&#x27;, field: &#x27;product_enabled&#x27;   },
    // { headerName: &#x27;Kasavana cat&#x27;, field: &#x27;product_kasavana_category&#x27;   },
    // { headerName: &#x27;Source&#x27;, field: &#x27;product_input_source&#x27;   },
    // {
    //   headerName: &#x27;Food_cost&#x27;, field: &#x27;product_food_cost_ext&#x27;, editable: true,
    //   width: 110,
    //   valueFormatter: params &#x3D;&gt; TableLib.currencyFormatter(params.value),
    // },
    // {
    //   headerName: &#x27;Contribution&#x27;, field: &#x27;ccc_contribution&#x27;, width: 110,
    //   valueFormatter: params &#x3D;&gt; TableLib.currencyFormatter(params.value),
    // },
    // {
    //   headerName: &#x27;Incidence&#x27;, field: &#x27;ccc_incidence&#x27;, width: 110,
    //   valueFormatter: params &#x3D;&gt; TableLib.percentageFormatter(params.value),
    // },
  ];


  /********************************************************
  *  get Data
  */
  async getData() {
    // invoke API Gateway Service , async /await 
    let prodArr: Product[] &#x3D; await this.awsService.getProducts();

    // trasform category ID into catagory name
    let catArr: Category[] &#x3D; await this.awsService.getCategories();

    // load product Groups
    // let productGroups: ProductMerged[] &#x3D; await this.awsService.getProductMergeds();

    prodArr.forEach(row &#x3D;&gt; {   // for each row in table Product
      let catFound &#x3D; catArr.find(x &#x3D;&gt; x.categoryid &#x3D;&#x3D; String(row.product_category_id));  // find corresponding category
      if (catFound !&#x3D; undefined)
        row[&#x27;ccc_category_name&#x27;] &#x3D; catFound.name;   // assign name instead of ID
      row[&#x27;ccc_contribution&#x27;] &#x3D; +(row.product_sell_price - row.product_food_cost_ext).toFixed(1);
      row[&#x27;ccc_incidence&#x27;] &#x3D; +(row.product_food_cost_ext / row.product_sell_price * 100).toFixed(1);

    });

    // update gridApi category menu
    if (catArr) {
      const unique &#x3D; new Set(catArr.map(cat &#x3D;&gt; cat.name)); // load category names into array
      this.categories &#x3D; Array.from(unique.values()).sort();
    }
    return prodArr;
  }


  /********************************************************
  *  Refresh button pressed
  */
  refresh &#x3D; () &#x3D;&gt; {
    if (this.unsaved) {
      // ask confirmation
      var modalInstance &#x3D; this.myModal.show();
    }
    else {
      // this.awsService.clearSession(&#x27;product&#x27;);
      this.refreshData();
      this.unsaved &#x3D; false;
    }
  }


  /********************************************************
  *  Reload button pressed
  */
  reload &#x3D; () &#x3D;&gt; {
    this.awsService.clearSession(&#x27;product&#x27;);
    this.awsService.clearSession(&#x27;productGroup&#x27;);
    this.refresh();
  }


  // cell value changed
  async onCellValueChanged(params) {

    // if category description changed
    if (params.column.getId() &#x3D;&#x3D; &quot;ccc_category_name&quot;) {
      const newCategory &#x3D; params.node.data[&#x27;ccc_category_name&#x27;];
      // trasform category ID into catagory name
      let catArr: Category[] &#x3D; await this.awsService.getCategories();
      // find CAT ID
      let catFound &#x3D; catArr.find(x &#x3D;&gt; x.name &#x3D;&#x3D; newCategory);  // find corresponding category
      // assign new ID
      // if Category exist, assign new ID, else assign null
      params.node.data.product_category_id &#x3D; catFound ? catFound.categoryid : null;

      // paint red also ID column
      this.gridApi.getColumnDef(&quot;product_category_id&quot;).cellStyle &#x3D; function (params2) {
        if (params2.node.data[&#x27;changed&#x27;])
          return { background: &#x27;gold&#x27; };
      }
    }

    // call parent function
    super.onCellValueChanged(params);


    // change flag if Group changed
    if (params.column.getId() &#x3D;&#x3D; &quot;product_merged_name&quot;) {
      let product &#x3D; params.node.data;
      const prodArr &#x3D; this.rowData;
      const merged_products &#x3D; prodArr.filter(x &#x3D;&gt; x.product_merged_name &#x3D;&#x3D; product.product_merged_name);
      if (merged_products) // if exist
      {
        const all_equal &#x3D; merged_products.every(x &#x3D;&gt; x.product_category_id &#x3D;&#x3D; merged_products[0].product_category_id);
        // if category not equal
        if (!all_equal) {
          product.product_merged_name &#x3D; product.product_name;
          delete params.node.data.changed;
          params.api.redrawRows();
          this.messageService.show(&quot;Merge not allowed: product category do not match.&quot;);
          return;
        }
      }
      delete params.node.data.changed;
      params.node.data[&#x27;groupChange&#x27;] &#x3D; true;

      // refresh group aggregation
      params.api.refreshClientSideRowModel(&#x27;group&#x27;);

      // expand all groups
      // params.api.expandAll();
    }


  }

  /********************************************************
  *  Save button pressed
  */
  saveTable &#x3D; async () &#x3D;&gt; {
    if (!this.unsaved) {  // nothing to save
      this.messageService.show(&quot;Data already up-to-date. Nothing to save.&quot;);
      return;
    }

    // load product Groups
    let productGroups: ProductMerged[] &#x3D; await this.awsService.getProductMergeds();

    let prodArr: Product[] &#x3D; [];
    let groupArr: ProductMerged[] &#x3D; [];
    let groupDelete: ProductMerged[] &#x3D; [];
    this.rowData.forEach(row &#x3D;&gt; {  // for each row
      if (row &amp;&amp; row[&#x27;changed&#x27;]) {        // if exists attribute changed
        // row[&#x27;changed&#x27;] &#x3D; false;
        delete row.changed; // delete unused property
        // push to array to save 
        prodArr.push(row);
      }
      if (row &amp;&amp; row[&#x27;groupChange&#x27;]) {        // if exists attribute changed
        delete row.groupChange; // delete unused property

        // find productGroup
        const groupfound &#x3D; productGroups.find(p &#x3D;&gt; p.product_id &#x3D;&#x3D; row.product_id);

        let pg: ProductMerged &#x3D; {
          code: groupfound ? groupfound.code : 0,         // 0 &#x3D; new group, groupfound.code &#x3D; old code
          name: row.product_merged_name ? row.product_merged_name : groupfound.name,
          product_id: row.product_id
        }

        // push to array to save 
        if (row.product_merged_name &#x3D;&#x3D; &#x27;&#x27;) {
          // delete row.product_group_name;
          row.product_merged_name &#x3D; row.product_name;   // assign default value
          pg.name &#x3D; row.product_name;
          groupArr.push(pg);
          // groupDelete.push(pg);
          // refresh group aggregation
          this.gridApi.refreshClientSideRowModel(&#x27;group&#x27;);
        }
        else
          groupArr.push(pg);
      }
    });

    // save all changed products (single transaction)
    if (prodArr.length) {
      await this.awsService.saveProducts(prodArr);
      this.awsService.clearSession(&#x27;product&#x27;);
    }

    // save all  products group (single transaction)  productGroup
    if (groupArr.length) {
      await this.awsService.saveProductMergeds(groupArr);
      this.awsService.clearSession(&#x27;productGroup&#x27;);
    }

    // delete changed product group (single transaction)
    if (groupDelete.length) {
      await this.awsService.deleteProductMergeds(groupDelete);
      this.awsService.clearSession(&#x27;productGroup&#x27;);
    }

    // reset unsaved
    this.unsaved &#x3D; false;
    this.gridApi.redrawRows();
    this.messageService.show(&quot;Saved successfully.&quot;);
  }



  // menu delete/undelete clicked
  enableRow(row: Product, value: boolean) {
    // var res &#x3D; gridApi.applyTransaction({ remove: selectedData });
    row.product_enabled &#x3D; value;  // disbaale product
    row[&#x27;changed&#x27;] &#x3D; true;
  }

  getRowStyle(params) {
    // console.log(&quot;ciao&quot;);
    if (params.node.data &amp;&amp; params.node.data.product_enabled &#x3D;&#x3D; false) {
      return { color: &#x27;#ccc&#x27; };
    }
  }

  getRowNodeId(product) {
    return product.product_id;
  }

  /*********************************************** */
  newRow() {
    TableLib.addItems(this.gridApi);
    this.gridApi.ensureIndexVisible(this.gridApi.getRowNode(&quot;1&quot;).rowIndex);
    this.gridApi.getRowNode(&quot;1&quot;).setSelected(true);
    this.unsaved &#x3D; true;
  }

  deleteSelectedRow(value) {
    this.gridApi.getSelectedNodes().forEach(row &#x3D;&gt; {
      if (row.data) {
        row.data.product_enabled &#x3D; !value;  // disbaale product
        row.data[&#x27;changed&#x27;] &#x3D; true;
      }
    });
    // params.node.setSelected(false);
    this.unsaved &#x3D; true;
    this.gridApi.redrawRows();   // need redraw
  }

  /*********************************************** */
  // right button mouse context menu
  getContextMenuItems &#x3D; (params) &#x3D;&gt; {

    //params.node.setSelected(true);
    var result &#x3D; [
      {
        name: &#x27;Refresh&#x27;,
        action: () &#x3D;&gt; {
          params.api.refreshClientSideRowModel(&#x27;group&#x27;);
          params.api.refreshCells();
        }
      },
      {
        name: &#x27;New&#x27;,
        action: () &#x3D;&gt; {
          this.newRow();
        }
      },
      {
        name: &#x27;Delete&#x27;,
        action: () &#x3D;&gt; {
          this.deleteSelectedRow(true);
        }
      },
      {
        name: &#x27;Undelete&#x27;,
        action: () &#x3D;&gt; {
          this.deleteSelectedRow(false);
        }
      },
      &#x27;separator&#x27;,
      {
        name: &#x27;Copy&#x27;,
        action: () &#x3D;&gt; {
          this.onMenuClipboard(params.value);
        }
      },
      {
        name: &#x27;Export&#x27;,
        tooltip: &#x27;Export table&#x27;,
        subMenu: [
          {
            name: &#x27;Export as csv&#x27;,
            action: () &#x3D;&gt; {
              params.api.exportDataAsCsv(params);
            }
          },
          {
            name: &#x27;Export to Excel&#x27;,
            action: () &#x3D;&gt; {
              params.api.exportDataAsExcel(params);
            }
          }
        ] //end row submenu
      }
    ];
    return result;
  }



}
</code></pre>
    </div>
</div>


                   




                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'Product.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
