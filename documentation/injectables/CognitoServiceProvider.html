<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>@coreui/coreui-free-angular-admin-template documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">@coreui/coreui-free-angular-admin-template documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">







<ol class="breadcrumb">
  <li>Injectables</li>
  <li>CognitoServiceProvider</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/service/cognito-service.ts</code>
        </p>




            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                <a href="#_USER_POOL">_USER_POOL</a>
                            </li>
                            <li>
                                <a href="#SYSTEM_PARAMS">SYSTEM_PARAMS</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                <a href="#authenticate">authenticate</a>
                            </li>
                            <li>
                                <a href="#confirmUser">confirmUser</a>
                            </li>
                            <li>
                                <a href="#getUserName">getUserName</a>
                            </li>
                            <li>
                                <a href="#isUserLogged">isUserLogged</a>
                            </li>
                            <li>
                                <a href="#logout">logout</a>
                            </li>
                            <li>
                                <a href="#signUp">signUp</a>
                            </li>
                            <li>
                                <a href="#updateUserAttribute">updateUserAttribute</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>


            <section>
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="authenticate"></a>
                    <span class="name">
                        <b>
                            authenticate
                        </b>
                        <a href="#authenticate"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>authenticate(username, password)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="51"
                            class="link-to-prism">src/app/service/cognito-service.ts:51</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><hr>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>username</td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>password</td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="confirmUser"></a>
                    <span class="name">
                        <b>
                            confirmUser
                        </b>
                        <a href="#confirmUser"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>confirmUser(verificationCode, userName)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="135"
                            class="link-to-prism">src/app/service/cognito-service.ts:135</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>verificationCode</td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>userName</td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getUserName"></a>
                    <span class="name">
                        <b>
                            getUserName
                        </b>
                        <a href="#getUserName"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>getUserName()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="166"
                            class="link-to-prism">src/app/service/cognito-service.ts:166</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="isUserLogged"></a>
                    <span class="name">
                        <b>
                            isUserLogged
                        </b>
                        <a href="#isUserLogged"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>isUserLogged()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="174"
                            class="link-to-prism">src/app/service/cognito-service.ts:174</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="logout"></a>
                    <span class="name">
                        <b>
                            logout
                        </b>
                        <a href="#logout"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>logout()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="157"
                            class="link-to-prism">src/app/service/cognito-service.ts:157</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="signUp"></a>
                    <span class="name">
                        <b>
                            signUp
                        </b>
                        <a href="#signUp"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>signUp(username, password)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="112"
                            class="link-to-prism">src/app/service/cognito-service.ts:112</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><hr>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>username</td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>password</td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="updateUserAttribute"></a>
                    <span class="name">
                        <b>
                            updateUserAttribute
                        </b>
                        <a href="#updateUserAttribute"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
<code>updateUserAttribute(name, value)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="33"
                            class="link-to-prism">src/app/service/cognito-service.ts:33</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>name</td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>value</td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>
            <section>
    
        <h3 id="inputs">
            Properties
        </h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="_USER_POOL"></a>
                        <span class="name">
                            <b>
                            _USER_POOL</b>
                            <a href="#_USER_POOL"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>new AWSCognito.CognitoUserPool(this.SYSTEM_PARAMS.COGNITO_POOL)</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="31" class="link-to-prism">src/app/service/cognito-service.ts:31</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="SYSTEM_PARAMS"></a>
                        <span class="name">
                            <b>
                            SYSTEM_PARAMS</b>
                            <a href="#SYSTEM_PARAMS"><span class="icon ion-ios-link"></span></a>
                        </span>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Type : </i>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <i>Default value : </i><code>{
    REGION: &#x27;eu-central-1&#x27;,
    COGNITO_POOL: {
      UserPoolId: &#x27;eu-central-1_qwtSnbNGm&#x27;,
      ClientId: &#x27;1qiiabao5ce1s8k74lissr2b6h&#x27;,
      AuthFlow: &#x27;ADMIN_NO_SRP_AUTH&#x27;,
    }
  }</code>
                        </td>
                    </tr>
                        <tr>
                            <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="22" class="link-to-prism">src/app/service/cognito-service.ts:22</a></div>
                            </td>
                        </tr>


            </tbody>
        </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Injectable } from &#x27;@angular/core&#x27;;
import * as AWSCognito from &#x27;amazon-cognito-identity-js&#x27;;
// import * as AWS from &#x27;aws-sdk/global&#x27;;
let AWS &#x3D; require(&#x27;aws-sdk&#x27;);

AWS.config &#x3D; new AWS.Config();
AWS.config.accessKeyId &#x3D; &quot;AKIA2JPUZJZ6GMANRIDT&quot;;
AWS.config.secretAccessKey &#x3D; &quot;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&quot;;

let cognitoISP &#x3D; new AWS.CognitoIdentityServiceProvider({ region: &#x27;eu-central-1&#x27; });

// reference to aws sdk
// var AWS &#x3D; require(&#x27;aws-sdk/dist/aws-sdk-react-native&#x27;);

@Injectable({
  providedIn: &#x27;root&#x27;
})
export class CognitoServiceProvider {


  //m3m3t3c0_81
  SYSTEM_PARAMS: any &#x3D; {
    REGION: &#x27;eu-central-1&#x27;,
    COGNITO_POOL: {
      UserPoolId: &#x27;eu-central-1_qwtSnbNGm&#x27;,
      ClientId: &#x27;1qiiabao5ce1s8k74lissr2b6h&#x27;,
      AuthFlow: &#x27;ADMIN_NO_SRP_AUTH&#x27;,
    }
  };

  _USER_POOL &#x3D; new AWSCognito.CognitoUserPool(this.SYSTEM_PARAMS.COGNITO_POOL);

  updateUserAttribute(name, value) {
    return new Promise((resolve, reject) &#x3D;&gt; {
      let params &#x3D; {
        UserAttributes: [
          {
            Name: name,     // name of attribute
            Value: value    // the new attribute value
          }
        ],
        UserPoolId: this.SYSTEM_PARAMS.COGNITO_POOL.UserPoolId,
        Username: this._USER_POOL.getCurrentUser().getUsername()
      };

      cognitoISP.adminUpdateUserAttributes(params, (err, data) &#x3D;&gt; err ? reject(err) : resolve(data));
    });
  }

  /********************************************* */
  authenticate(username, password) {
    return new Promise((resolved, reject) &#x3D;&gt; {
      const authDetails &#x3D; new AWSCognito.AuthenticationDetails({
        Username: username,
        Password: password
      });

      const cognitoUser &#x3D; new AWSCognito.CognitoUser({
        Username: username,
        Pool: this._USER_POOL
      });

      cognitoUser.authenticateUser(authDetails, {
        onSuccess: result &#x3D;&gt; {
          resolved(result.getAccessToken().getJwtToken());

          sessionStorage.setItem(&#x27;awstkn&#x27;, result.getIdToken().getJwtToken());

          // get user data
          cognitoUser.getUserAttributes(function (err, result) {
            if (err) {
              alert(err.message || JSON.stringify(err));
              return;
            }
            for (var i &#x3D; 0; i &lt; result.length; i++) {
              // save phone number
              if (result[i].getName() &#x3D;&#x3D; &#x27;phone_number&#x27;)
                sessionStorage.setItem(&#x27;user_phone_number&#x27;, result[i].getValue());
              // save email
              if (result[i].getName() &#x3D;&#x3D; &#x27;email&#x27;)
                sessionStorage.setItem(&#x27;user_email&#x27;, result[i].getValue());
            }
          });


        },
        onFailure: err &#x3D;&gt; {
          reject(err);
        },
        newPasswordRequired: userAttributes &#x3D;&gt; {
          // User was signed up by an admin and must provide new
          // password and required attributes, if any, to complete
          // authentication.

          // the api doesn&#x27;t accept this field back
          userAttributes.username &#x3D; username;
          delete userAttributes.email_verified;

          /*cognitoUser.completeNewPasswordChallenge(password, userAttributes, {
            onSuccess: function(result) {},
            onFailure: function(error) {
              reject(error);
            }
          });*/
        }
      });
    });
  }


  /********************************************** */
  signUp(username, password) {
    return new Promise((resolved, reject) &#x3D;&gt; {
      let userAttribute &#x3D; [];
      userAttribute.push(
        new AWSCognito.CognitoUserAttribute({
          Name: &#x27;username&#x27;,
          Value: username
        })
      );

      this._USER_POOL.signUp(username, password, userAttribute, null, function (
        err,
        result
      ) {
        if (err) {
          reject(err);
        } else {
          resolved(result);
        }
      });
    });
  }

  confirmUser(verificationCode, userName) {
    return new Promise((resolved, reject) &#x3D;&gt; {
      const cognitoUser &#x3D; new AWSCognito.CognitoUser({
        Username: userName,
        Pool: this._USER_POOL
      });

      cognitoUser.confirmRegistration(verificationCode, true, function (
        err,
        result
      ) {
        if (err) {
          reject(err);
        } else {
          resolved(result);
        }
      });
    });
  }



  logout() {
    // AccountMgr.logout(this._USER_POOL.getCurrentUser());

    var cognitoUser &#x3D; this._USER_POOL.getCurrentUser();
    if (cognitoUser !&#x3D; null)
      cognitoUser.signOut();

  }

  getUserName(): string {
    var cognitoUser &#x3D; this._USER_POOL.getCurrentUser();
    if (cognitoUser !&#x3D; null)
      return cognitoUser.getUsername();
  }


  // getExpiration
  isUserLogged(): boolean {
    const cognitoUser &#x3D; this._USER_POOL.getCurrentUser();

    let isSessionValid &#x3D; true;
    if (cognitoUser &#x3D;&#x3D; null)  // user not logged
      return false;

    if (!sessionStorage.getItem(&#x27;awstkn&#x27;))
      return false;     // token not in memory

    cognitoUser.getSession(function (err, session) {
      if (err) {
        isSessionValid &#x3D; false;   // session not valid
      }
      // check token expired
      const exp_time &#x3D; session.getAccessToken().getExpiration();
      const now &#x3D; new Date().getTime() / 1000;
      if (now &gt; exp_time)
        isSessionValid &#x3D; false;
      // console.log(&quot;Session&quot;, session);
    });

    return isSessionValid;
  };

}</code></pre>
    </div>

</div>







                   




                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'CognitoServiceProvider.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
